<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Crear Medicamento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Test - Crear Medicamento desde Frontend</h2>
        <div id="status" class="alert alert-info">Preparando prueba...</div>
        
        <div class="card">
            <div class="card-header">
                <h5>Formulario de Prueba</h5>
            </div>
            <div class="card-body">
                <form id="testForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="codigo" class="form-label">Código</label>
                                <input type="text" class="form-control" id="codigo" value="MED008">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="nombre" class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="nombre" value="Acetaminofén">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="descripcion" class="form-label">Descripción</label>
                        <textarea class="form-control" id="descripcion">Analgésico y antipirético de prueba</textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="categoria" class="form-label">Categoría</label>
                                <select class="form-select" id="categoria">
                                    <option value="Analgésicos" selected>Analgésicos</option>
                                    <option value="Antiinflamatorios">Antiinflamatorios</option>
                                    <option value="Antibióticos">Antibióticos</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="fabricante" class="form-label">Fabricante</label>
                                <input type="text" class="form-control" id="fabricante" value="Laboratorio Test">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="precio" class="form-label">Precio</label>
                                <input type="number" step="0.01" class="form-control" id="precio" value="12.50">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="stock" class="form-label">Stock</label>
                                <input type="number" class="form-control" id="stock" value="100">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="stockMinimo" class="form-label">Stock Mínimo</label>
                                <input type="number" class="form-control" id="stockMinimo" value="20">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="requiereReceta">
                            <label class="form-check-label" for="requiereReceta">
                                Requiere Receta
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="activo" checked>
                            <label class="form-check-label" for="activo">
                                Activo
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Crear Medicamento de Prueba</button>
                </form>
            </div>
        </div>
        
        <div id="resultado" class="mt-4"></div>
    </div>

    <script src="js/utils.js"></script>
    <script>
        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const statusDiv = document.getElementById('status');
            const resultadoDiv = document.getElementById('resultado');
            
            statusDiv.className = 'alert alert-warning';
            statusDiv.textContent = 'Creando medicamento...';
            
            try {
                // Recopilar datos del formulario
                const formData = {
                    codigo: document.getElementById('codigo').value,
                    nombre: document.getElementById('nombre').value,
                    descripcion: document.getElementById('descripcion').value,
                    categoria: document.getElementById('categoria').value,
                    fabricante: document.getElementById('fabricante').value,
                    precio: parseFloat(document.getElementById('precio').value),
                    stock: parseInt(document.getElementById('stock').value),
                    stockMinimo: parseInt(document.getElementById('stockMinimo').value),
                    requiereReceta: document.getElementById('requiereReceta').checked,
                    activo: document.getElementById('activo').checked
                };
                
                console.log('Datos a enviar:', formData);
                
                // Crear medicamento usando AppUtils
                const response = await AppUtils.create('medicamentos', formData);
                
                if (response.ok) {
                    const medicamento = await response.json();
                    statusDiv.className = 'alert alert-success';
                    statusDiv.textContent = '✅ Medicamento creado exitosamente!';
                    
                    resultadoDiv.innerHTML = `
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h6>Medicamento Creado</h6>
                            </div>
                            <div class="card-body">
                                <dl class="row">
                                    <dt class="col-sm-3">ID:</dt>
                                    <dd class="col-sm-9">${medicamento.id}</dd>
                                    <dt class="col-sm-3">Código:</dt>
                                    <dd class="col-sm-9">${medicamento.codigo}</dd>
                                    <dt class="col-sm-3">Nombre:</dt>
                                    <dd class="col-sm-9">${medicamento.nombre}</dd>
                                    <dt class="col-sm-3">Categoría:</dt>
                                    <dd class="col-sm-9">${medicamento.categoria}</dd>
                                    <dt class="col-sm-3">Precio:</dt>
                                    <dd class="col-sm-9">$${medicamento.precio}</dd>
                                    <dt class="col-sm-3">Stock:</dt>
                                    <dd class="col-sm-9">${medicamento.stock}</dd>
                                </dl>
                            </div>
                        </div>
                    `;
                } else {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
            } catch (error) {
                console.error('Error:', error);
                statusDiv.className = 'alert alert-danger';
                statusDiv.textContent = `❌ Error: ${error.message}`;
                
                resultadoDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>Error al crear medicamento</h6>
                        <pre>${JSON.stringify(error, null, 2)}</pre>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
