<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Cargar Pacientes y Médicos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Test - Cargar Opciones de Citas</h2>
        <div id="status" class="alert alert-info">Cargando...</div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Pacientes Disponibles</h5>
                    </div>
                    <div class="card-body">
                        <select class="form-select" id="testPacienteSelect">
                            <option value="">Seleccione un paciente</option>
                        </select>
                        <div id="pacientesInfo" class="mt-3"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Médicos Disponibles</h5>
                    </div>
                    <div class="card-body">
                        <select class="form-select" id="testMedicoSelect">
                            <option value="">Seleccione un médico</option>
                        </select>
                        <div id="medicosInfo" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <h4>Datos Cargados:</h4>
            <div id="datosInfo"></div>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script>
        async function testLoadOptions() {
            const statusDiv = document.getElementById('status');
            const pacientesInfoDiv = document.getElementById('pacientesInfo');
            const medicosInfoDiv = document.getElementById('medicosInfo');
            const datosInfoDiv = document.getElementById('datosInfo');
            
            try {
                statusDiv.textContent = 'Cargando pacientes...';
                console.log('Cargando pacientes...');
                
                // Cargar pacientes
                const pacientes = await AppUtils.get('/api/pacientes');
                console.log('Pacientes cargados:', pacientes);
                
                const pacienteSelect = document.getElementById('testPacienteSelect');
                pacientes.forEach(paciente => {
                    const option = document.createElement('option');
                    option.value = paciente.id;
                    option.textContent = `${paciente.nombres} ${paciente.apellidos}`;
                    pacienteSelect.appendChild(option);
                });
                
                pacientesInfoDiv.innerHTML = `<small class="text-muted">${pacientes.length} pacientes cargados</small>`;
                
                statusDiv.textContent = 'Cargando médicos...';
                console.log('Cargando médicos...');
                
                // Cargar médicos
                const medicos = await AppUtils.get('/api/medicos');
                console.log('Médicos cargados:', medicos);
                
                const medicoSelect = document.getElementById('testMedicoSelect');
                medicos.forEach(medico => {
                    const option = document.createElement('option');
                    option.value = medico.id;
                    option.textContent = `${medico.nombres} ${medico.apellidos} - ${medico.especializacion}`;
                    medicoSelect.appendChild(option);
                });
                
                medicosInfoDiv.innerHTML = `<small class="text-muted">${medicos.length} médicos cargados</small>`;
                
                statusDiv.className = 'alert alert-success';
                statusDiv.textContent = '✅ Datos cargados exitosamente!';
                
                // Mostrar resumen de datos
                datosInfoDiv.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Pacientes (${pacientes.length}):</h6>
                            <ul class="list-group list-group-flush">
                                ${pacientes.map(p => `
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>${p.nombres} ${p.apellidos}</span>
                                        <span class="badge bg-primary">${p.id}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Médicos (${medicos.length}):</h6>
                            <ul class="list-group list-group-flush">
                                ${medicos.map(m => `
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>${m.nombres} ${m.apellidos} - ${m.especializacion}</span>
                                        <span class="badge bg-success">${m.id}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error:', error);
                statusDiv.className = 'alert alert-danger';
                statusDiv.textContent = `❌ Error: ${error.message}`;
                
                datosInfoDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>Error al cargar datos</h6>
                        <pre>${JSON.stringify(error, null, 2)}</pre>
                    </div>
                `;
            }
        }
        
        // Ejecutar la prueba cuando la página cargue
        document.addEventListener('DOMContentLoaded', testLoadOptions);
    </script>
</body>
</html>
