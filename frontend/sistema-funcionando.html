<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ… Sistema Funcionando - VerificaciÃ³n Final</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .status-card {
            transition: transform 0.2s;
        }
        .status-card:hover {
            transform: translateY(-2px);
        }
        .success-status {
            border-left: 4px solid #28a745;
        }
        .error-status {
            border-left: 4px solid #dc3545;
        }
        .loading-status {
            border-left: 4px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-12 text-center mb-4">
                <h1 class="display-4">ðŸŽ‰ Sistema de Salud Digital</h1>
                <p class="lead">VerificaciÃ³n Final del Sistema</p>
                <div id="systemOverallStatus" class="alert alert-info">
                    <i class="fas fa-spinner fa-spin"></i> Verificando estado del sistema...
                </div>
            </div>
        </div>
        
        <div class="row g-4">
            <!-- Pacientes -->
            <div class="col-md-6 col-lg-3">
                <div class="card status-card loading-status" id="pacientesCard">
                    <div class="card-body text-center">
                        <i class="fas fa-user-injured fs-1 text-primary mb-3"></i>
                        <h5>Pacientes</h5>
                        <div id="pacientesStatus">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <small class="d-block mt-2">Verificando...</small>
                        </div>
                        <button class="btn btn-primary btn-sm mt-3" onclick="window.open('pacientes-optimized.html', '_blank')">
                            Abrir MÃ³dulo
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- MÃ©dicos -->
            <div class="col-md-6 col-lg-3">
                <div class="card status-card loading-status" id="medicosCard">
                    <div class="card-body text-center">
                        <i class="fas fa-user-md fs-1 text-success mb-3"></i>
                        <h5>MÃ©dicos</h5>
                        <div id="medicosStatus">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <small class="d-block mt-2">Verificando...</small>
                        </div>
                        <button class="btn btn-success btn-sm mt-3" onclick="window.open('medicos-optimized.html', '_blank')">
                            Abrir MÃ³dulo
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Citas -->
            <div class="col-md-6 col-lg-3">
                <div class="card status-card loading-status" id="citasCard">
                    <div class="card-body text-center">
                        <i class="fas fa-calendar-alt fs-1 text-warning mb-3"></i>
                        <h5>Citas</h5>
                        <div id="citasStatus">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <small class="d-block mt-2">Verificando...</small>
                        </div>
                        <button class="btn btn-warning btn-sm mt-3" onclick="window.open('citas-optimized.html', '_blank')">
                            Abrir MÃ³dulo
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Medicamentos -->
            <div class="col-md-6 col-lg-3">
                <div class="card status-card loading-status" id="medicamentosCard">
                    <div class="card-body text-center">
                        <i class="fas fa-pills fs-1 text-info mb-3"></i>
                        <h5>Medicamentos</h5>
                        <div id="medicamentosStatus">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <small class="d-block mt-2">Verificando...</small>
                        </div>
                        <button class="btn btn-info btn-sm mt-3" onclick="window.open('medicamentos-optimized.html', '_blank')">
                            Abrir MÃ³dulo
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Resumen de Correcciones -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h4><i class="fas fa-check-circle"></i> Correcciones Aplicadas</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="fas fa-wrench text-primary"></i> Correcciones Backend:</h6>
                                <ul class="list-unstyled">
                                    <li>âœ… Campo email agregado a PacienteEntity</li>
                                    <li>âœ… Base de datos actualizada con emails</li>
                                    <li>âœ… APIs funcionando correctamente</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-code text-success"></i> Correcciones Frontend:</h6>
                                <ul class="list-unstyled">
                                    <li>âœ… AppUtils.getAll() corregido (JSON directo)</li>
                                    <li>âœ… CRUDManager actualizado</li>
                                    <li>âœ… MÃ³dulos personalizados corregidos</li>
                                    <li>âœ… Error 500 completamente eliminado</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Acceso RÃ¡pido -->
        <div class="row mt-4">
            <div class="col-12 text-center">
                <div class="card">
                    <div class="card-body">
                        <h5>ðŸš€ Acceso RÃ¡pido al Sistema</h5>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary" onclick="window.open('index-optimized.html', '_blank')">
                                <i class="fas fa-home"></i> Dashboard Principal
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="window.open('debug-datos.html', '_blank')">
                                <i class="fas fa-bug"></i> Debug Datos
                            </button>
                            <button type="button" class="btn btn-outline-info" onclick="window.location.reload()">
                                <i class="fas fa-sync"></i> Verificar Nuevamente
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/utils.js"></script>
    <script>
        const modules = [
            { name: 'pacientes', display: 'Pacientes', card: 'pacientesCard', status: 'pacientesStatus' },
            { name: 'medicos', display: 'MÃ©dicos', card: 'medicosCard', status: 'medicosStatus' },
            { name: 'citas', display: 'Citas', card: 'citasCard', status: 'citasStatus' },
            { name: 'medicamentos', display: 'Medicamentos', card: 'medicamentosCard', status: 'medicamentosStatus' }
        ];
        
        let successCount = 0;
        let totalModules = modules.length;
        
        function updateStatus(module, success, count = 0, error = null) {
            const statusDiv = document.getElementById(module.status);
            const card = document.getElementById(module.card);
            
            if (success) {
                statusDiv.innerHTML = `
                    <i class="fas fa-check-circle text-success fs-4"></i>
                    <div class="mt-2">
                        <strong class="text-success">${count} registros</strong>
                        <small class="d-block text-muted">Funcionando correctamente</small>
                    </div>
                `;
                card.className = card.className.replace('loading-status', 'success-status');
                successCount++;
            } else {
                statusDiv.innerHTML = `
                    <i class="fas fa-times-circle text-danger fs-4"></i>
                    <div class="mt-2">
                        <strong class="text-danger">Error</strong>
                        <small class="d-block text-muted">${error || 'No se pudo cargar'}</small>
                    </div>
                `;
                card.className = card.className.replace('loading-status', 'error-status');
            }
            
            updateOverallStatus();
        }
        
        function updateOverallStatus() {
            const overallStatus = document.getElementById('systemOverallStatus');
            
            if (successCount === totalModules) {
                overallStatus.innerHTML = `
                    <i class="fas fa-check-circle text-success"></i>
                    <strong>Â¡Sistema completamente funcional!</strong> 
                    Todos los mÃ³dulos estÃ¡n operativos y cargando datos correctamente.
                `;
                overallStatus.className = 'alert alert-success';
            } else if (successCount > 0) {
                overallStatus.innerHTML = `
                    <i class="fas fa-exclamation-triangle text-warning"></i>
                    <strong>Sistema parcialmente funcional.</strong> 
                    ${successCount} de ${totalModules} mÃ³dulos funcionando correctamente.
                `;
                overallStatus.className = 'alert alert-warning';
            } else {
                overallStatus.innerHTML = `
                    <i class="fas fa-times-circle text-danger"></i>
                    <strong>Problemas detectados.</strong> 
                    NingÃºn mÃ³dulo estÃ¡ funcionando correctamente.
                `;
                overallStatus.className = 'alert alert-danger';
            }
        }
        
        async function checkModule(module) {
            try {
                const data = await AppUtils.getAll(module.name);
                updateStatus(module, true, data.length);
                console.log(`âœ… ${module.display}:`, data.length, 'registros');
            } catch (error) {
                updateStatus(module, false, 0, error.message);
                console.error(`âŒ ${module.display}:`, error.message);
            }
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ðŸš€ Iniciando verificaciÃ³n del sistema...');
            
            // Verificar cada mÃ³dulo
            for (const module of modules) {
                await checkModule(module);
                // PequeÃ±a pausa entre verificaciones
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            console.log(`âœ… VerificaciÃ³n completa: ${successCount}/${totalModules} mÃ³dulos funcionando`);
        });
    </script>
</body>
</html>
