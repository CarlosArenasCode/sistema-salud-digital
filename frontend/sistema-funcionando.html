<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>✅ Sistema Funcionando - Verificación Final</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/icons.css" rel="stylesheet">
    <style>
        .status-card {
            transition: transform 0.2s;
        }
        .status-card:hover {
            transform: translateY(-2px);
        }
        .success-status {
            border-left: 4px solid #28a745;
        }
        .error-status {
            border-left: 4px solid #dc3545;
        }
        .loading-status {
            border-left: 4px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row">            <div class="col-12 text-center mb-4">
                <h1 class="display-4">🎉 Sistema de Salud Digital</h1>
                <p class="lead">Verificación Final del Sistema</p>
                <div id="systemOverallStatus" class="alert alert-info">
                    <svg class="svg-icon icon-spin me-2" viewBox="0 0 24 24">
                        <path d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z" fill="currentColor"/>
                    </svg> Verificando estado del sistema...
                </div>
            </div>
        </div>
        
        <div class="row g-4">            <!-- Pacientes -->
            <div class="col-md-6 col-lg-3">
                <div class="card status-card loading-status" id="pacientesCard">
                    <div class="card-body text-center">
                        <svg class="svg-icon icon-lg text-primary mb-3" viewBox="0 0 24 24">
                            <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1L13.5 2.5L16.17 5.33L10.5 11L16 12.5L11.5 17L13 18.5L21 10.5V9ZM9.83 12.88L8 14.71L5.71 12.42C5.32 12.03 4.69 12.03 4.3 12.42S3.91 13.58 4.3 13.97L7.59 17.26C7.98 17.65 8.61 17.65 9 17.26L12.17 14.09L9.83 12.88Z" fill="currentColor"/>
                        </svg>
                        <h5>Pacientes</h5>
                        <div id="pacientesStatus">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <small class="d-block mt-2">Verificando...</small>
                        </div>
                        <button class="btn btn-primary btn-sm mt-3" onclick="window.open('pacientes-optimized.html', '_blank')">
                            Abrir Módulo
                        </button>
                    </div>
                </div>
            </div>
              <!-- Médicos -->
            <div class="col-md-6 col-lg-3">
                <div class="card status-card loading-status" id="medicosCard">
                    <div class="card-body text-center">
                        <svg class="svg-icon icon-lg text-success mb-3" viewBox="0 0 24 24">
                            <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1L13.5 2.5L16.17 5.33L10.5 11L16 12.5L11.5 17L13 18.5L21 10.5V9ZM9.83 12.88L8 14.71L5.71 12.42C5.32 12.03 4.69 12.03 4.3 12.42S3.91 13.58 4.3 13.97L7.59 17.26C7.98 17.65 8.61 17.65 9 17.26L12.17 14.09L9.83 12.88Z" fill="currentColor"/>
                        </svg>
                        <h5>Médicos</h5>
                        <div id="medicosStatus">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <small class="d-block mt-2">Verificando...</small>
                        </div>
                        <button class="btn btn-success btn-sm mt-3" onclick="window.open('medicos-optimized.html', '_blank')">
                            Abrir Módulo
                        </button>
                    </div>
                </div>
            </div>
              <!-- Citas -->
            <div class="col-md-6 col-lg-3">
                <div class="card status-card loading-status" id="citasCard">
                    <div class="card-body text-center">
                        <svg class="svg-icon icon-lg text-warning mb-3" viewBox="0 0 24 24">
                            <path d="M19,3H18V1H16V3H8V1H6V3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z" fill="currentColor"/>
                        </svg>
                        <h5>Citas</h5>
                        <div id="citasStatus">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <small class="d-block mt-2">Verificando...</small>
                        </div>
                        <button class="btn btn-warning btn-sm mt-3" onclick="window.open('citas-optimized.html', '_blank')">
                            Abrir Módulo
                        </button>
                    </div>
                </div>
            </div>
              <!-- Medicamentos -->
            <div class="col-md-6 col-lg-3">
                <div class="card status-card loading-status" id="medicamentosCard">
                    <div class="card-body text-center">
                        <svg class="svg-icon icon-lg text-info mb-3" viewBox="0 0 24 24">
                            <path d="M6,3H18A3,3 0 0,1 21,6V18A3,3 0 0,1 18,21H6A3,3 0 0,1 3,18V6A3,3 0 0,1 6,3M6,5A1,1 0 0,0 5,6V18A1,1 0 0,0 6,19H18A1,1 0 0,0 19,18V6A1,1 0 0,0 18,5H6M6,7H18V9H16V11H14V9H10V11H8V9H6V7M8,13H10V15H8V13M14,13H16V15H14V13M8,17H10V19H8V17M14,17H16V19H14V17Z" fill="currentColor"/>
                        </svg>
                        <h5>Medicamentos</h5>
                        <div id="medicamentosStatus">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <small class="d-block mt-2">Verificando...</small>
                        </div>
                        <button class="btn btn-info btn-sm mt-3" onclick="window.open('medicamentos-optimized.html', '_blank')">
                            Abrir Módulo
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Resumen de Correcciones -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h4><i class="fas fa-check-circle"></i> Correcciones Aplicadas</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="fas fa-wrench text-primary"></i> Correcciones Backend:</h6>
                                <ul class="list-unstyled">
                                    <li>✅ Campo email agregado a PacienteEntity</li>
                                    <li>✅ Base de datos actualizada con emails</li>
                                    <li>✅ APIs funcionando correctamente</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-code text-success"></i> Correcciones Frontend:</h6>
                                <ul class="list-unstyled">
                                    <li>✅ AppUtils.getAll() corregido (JSON directo)</li>
                                    <li>✅ CRUDManager actualizado</li>
                                    <li>✅ Módulos personalizados corregidos</li>
                                    <li>✅ Error 500 completamente eliminado</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Acceso Rápido -->
        <div class="row mt-4">
            <div class="col-12 text-center">
                <div class="card">
                    <div class="card-body">
                        <h5>🚀 Acceso Rápido al Sistema</h5>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary" onclick="window.open('index-optimized.html', '_blank')">
                                <i class="fas fa-home"></i> Dashboard Principal
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="window.open('debug-datos.html', '_blank')">
                                <i class="fas fa-bug"></i> Debug Datos
                            </button>
                            <button type="button" class="btn btn-outline-info" onclick="window.location.reload()">
                                <i class="fas fa-sync"></i> Verificar Nuevamente
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/icons.js"></script>
    <script src="js/utils.js"></script>
    <script>
        const modules = [
            { name: 'pacientes', display: 'Pacientes', card: 'pacientesCard', status: 'pacientesStatus' },
            { name: 'medicos', display: 'Médicos', card: 'medicosCard', status: 'medicosStatus' },
            { name: 'citas', display: 'Citas', card: 'citasCard', status: 'citasStatus' },
            { name: 'medicamentos', display: 'Medicamentos', card: 'medicamentosCard', status: 'medicamentosStatus' }
        ];
        
        let successCount = 0;
        let totalModules = modules.length;
        
        function updateStatus(module, success, count = 0, error = null) {
            const statusDiv = document.getElementById(module.status);
            const card = document.getElementById(module.card);
            
            if (success) {
                statusDiv.innerHTML = `
                    <i class="fas fa-check-circle text-success fs-4"></i>
                    <div class="mt-2">
                        <strong class="text-success">${count} registros</strong>
                        <small class="d-block text-muted">Funcionando correctamente</small>
                    </div>
                `;
                card.className = card.className.replace('loading-status', 'success-status');
                successCount++;
            } else {
                statusDiv.innerHTML = `
                    <i class="fas fa-times-circle text-danger fs-4"></i>
                    <div class="mt-2">
                        <strong class="text-danger">Error</strong>
                        <small class="d-block text-muted">${error || 'No se pudo cargar'}</small>
                    </div>
                `;
                card.className = card.className.replace('loading-status', 'error-status');
            }
            
            updateOverallStatus();
        }
        
        function updateOverallStatus() {
            const overallStatus = document.getElementById('systemOverallStatus');
            
            if (successCount === totalModules) {
                overallStatus.innerHTML = `
                    <i class="fas fa-check-circle text-success"></i>
                    <strong>¡Sistema completamente funcional!</strong> 
                    Todos los módulos están operativos y cargando datos correctamente.
                `;
                overallStatus.className = 'alert alert-success';
            } else if (successCount > 0) {
                overallStatus.innerHTML = `
                    <i class="fas fa-exclamation-triangle text-warning"></i>
                    <strong>Sistema parcialmente funcional.</strong> 
                    ${successCount} de ${totalModules} módulos funcionando correctamente.
                `;
                overallStatus.className = 'alert alert-warning';
            } else {
                overallStatus.innerHTML = `
                    <i class="fas fa-times-circle text-danger"></i>
                    <strong>Problemas detectados.</strong> 
                    Ningún módulo está funcionando correctamente.
                `;
                overallStatus.className = 'alert alert-danger';
            }
        }
        
        async function checkModule(module) {
            try {
                const data = await AppUtils.getAll(module.name);
                updateStatus(module, true, data.length);
                console.log(`✅ ${module.display}:`, data.length, 'registros');
            } catch (error) {
                updateStatus(module, false, 0, error.message);
                console.error(`❌ ${module.display}:`, error.message);
            }
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 Iniciando verificación del sistema...');
            
            // Verificar cada módulo
            for (const module of modules) {
                await checkModule(module);
                // Pequeña pausa entre verificaciones
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            console.log(`✅ Verificación completa: ${successCount}/${totalModules} módulos funcionando`);
        });
    </script>
</body>
</html>
