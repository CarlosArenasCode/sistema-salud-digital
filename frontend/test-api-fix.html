<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Fix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Test API Fix</h1>
        
        <div class="row">
            <div class="col-md-6">
                <h3>Pacientes</h3>
                <button id="testPacientes" class="btn btn-primary">Cargar Pacientes</button>
                <div id="pacientesResult" class="mt-3"></div>
            </div>
            
            <div class="col-md-6">
                <h3>Médicos</h3>
                <button id="testMedicos" class="btn btn-primary">Cargar Médicos</button>
                <div id="medicosResult" class="mt-3"></div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <h3>Citas</h3>
                <button id="testCitas" class="btn btn-primary">Cargar Citas</button>
                <div id="citasResult" class="mt-3"></div>
            </div>
            
            <div class="col-md-6">
                <h3>Medicamentos</h3>
                <button id="testMedicamentos" class="btn btn-primary">Cargar Medicamentos</button>
                <div id="medicamentosResult" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/utils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Test Pacientes
            document.getElementById('testPacientes').addEventListener('click', async function() {
                try {
                    const pacientes = await AppUtils.getAll('pacientes');
                    document.getElementById('pacientesResult').innerHTML = 
                        `<div class="alert alert-success">✅ Éxito: ${pacientes.length} pacientes cargados</div>`;
                    console.log('Pacientes:', pacientes);
                } catch (error) {
                    document.getElementById('pacientesResult').innerHTML = 
                        `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
                    console.error('Error pacientes:', error);
                }
            });

            // Test Médicos
            document.getElementById('testMedicos').addEventListener('click', async function() {
                try {
                    const medicos = await AppUtils.getAll('medicos');
                    document.getElementById('medicosResult').innerHTML = 
                        `<div class="alert alert-success">✅ Éxito: ${medicos.length} médicos cargados</div>`;
                    console.log('Médicos:', medicos);
                } catch (error) {
                    document.getElementById('medicosResult').innerHTML = 
                        `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
                    console.error('Error médicos:', error);
                }
            });

            // Test Citas
            document.getElementById('testCitas').addEventListener('click', async function() {
                try {
                    const citas = await AppUtils.getAll('citas');
                    document.getElementById('citasResult').innerHTML = 
                        `<div class="alert alert-success">✅ Éxito: ${citas.length} citas cargadas</div>`;
                    console.log('Citas:', citas);
                } catch (error) {
                    document.getElementById('citasResult').innerHTML = 
                        `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
                    console.error('Error citas:', error);
                }
            });

            // Test Medicamentos
            document.getElementById('testMedicamentos').addEventListener('click', async function() {
                try {
                    const medicamentos = await AppUtils.getAll('medicamentos');
                    document.getElementById('medicamentosResult').innerHTML = 
                        `<div class="alert alert-success">✅ Éxito: ${medicamentos.length} medicamentos cargados</div>`;
                    console.log('Medicamentos:', medicamentos);
                } catch (error) {
                    document.getElementById('medicamentosResult').innerHTML = 
                        `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
                    console.error('Error medicamentos:', error);
                }
            });

            // Test automático al cargar
            setTimeout(async function() {
                console.log('Iniciando test automático...');
                try {
                    const pacientes = await AppUtils.getAll('pacientes');
                    console.log('✅ Test automático exitoso - Pacientes:', pacientes.length);
                } catch (error) {
                    console.log('❌ Test automático falló:', error.message);
                }
            }, 1000);
        });
    </script>
</body>
</html>
